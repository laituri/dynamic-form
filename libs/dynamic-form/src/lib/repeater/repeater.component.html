<p *ngIf="field.title" dyna-label [field]="field">
  {{ field.title }}
</p>

<dyna-description *ngIf="field.description" [body]="field.description">
</dyna-description>

<div class="repeater-container" cdkDropList (cdkDropListDropped)="drop($event)">
  <div
    class="repeater-child"
    *ngFor="let control of controlsArray.controls; let i = index"
    [formGroup]="control"
    cdkDrag
    #repeaterChildElement
  >
    <div class="repeater-child-header">
      <div class="info" cdkDragHandle (click)="hideItemFields(fieldsElement)">
        <div class="drag-handle"></div>
        <div class="number">
          {{ i + 1 }}
        </div>
        <h4 class="title">
          {{ getDisplayValue(control) }}
        </h4>
      </div>
      <div class="actions">
        <button
          class="dyna-button warning"
          (click)="deleteControlItem(i, repeaterChildElement)"
        >
          Delete
        </button>
      </div>
    </div>
    <div class="fields-container" #fieldsElement>
      <div
        *ngFor="let field of fields"
        [ngSwitch]="field.type"
        [hidden]="field | fieldCondition: control | async"
      >
        <!-- Short text input fields -->
        <dyna-text
          *ngSwitchCase="'text'"
          type="text"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-text>

        <dyna-text
          *ngSwitchCase="'email'"
          type="email"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-text>

        <dyna-text
          *ngSwitchCase="'tel'"
          type="tel"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-text>

        <dyna-text
          *ngSwitchCase="'number'"
          type="number"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-text>

        <dyna-text
          *ngSwitchCase="'url'"
          type="url"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-text>

        <!-- Longer text fields -->
        <dyna-textarea
          *ngSwitchCase="'textarea'"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-textarea>

        <dyna-markdown
          *ngSwitchCase="'markdown'"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-markdown>

        <!-- Other fields -->

        <dyna-radio
          *ngSwitchCase="'radio'"
          [control]="getControl(control, field)"
          [field]="field"
        ></dyna-radio>

        <dyna-color
          *ngSwitchCase="'color'"
          [control]="getControl(control, field)"
          [field]="field"
        ></dyna-color>

        <dyna-date
          *ngSwitchCase="'date'"
          [control]="getControl(control, field)"
          [field]="field"
        ></dyna-date>

        <dyna-chips
          *ngSwitchCase="'chips'"
          [control]="getControl(control, field)"
          [field]="field"
        ></dyna-chips>

        <dyna-info *ngSwitchCase="'info'" [field]="field"></dyna-info>

        <!-- Option fields -->
        <dyna-dropdown
          *ngSwitchCase="'dropdown'"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-dropdown>

        <dyna-checkbox
          *ngSwitchCase="'checkbox'"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-checkbox>

        <dyna-checkbox-group
          *ngSwitchCase="'checkbox-group'"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-checkbox-group>

        <dyna-relation-select
          *ngSwitchCase="'relation'"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-relation-select>

        <!-- Async fields -->
        <dyna-action
          *ngSwitchCase="'action'"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-action>

        <dyna-file
          *ngSwitchCase="'file'"
          [control]="getControl(control, field)"
          [field]="field"
        >
        </dyna-file>

        <!-- Sub form fields -->
        <dyna-repeater
          *ngSwitchCase="'repeater'"
          [controlsArray]="getControl(control, field)"
          [field]="field"
          [fields]="field.fields"
        >
        </dyna-repeater>

        <dyna-group
          *ngSwitchCase="'group'"
          [control]="getControl(control, field)"
          [field]="field"
          [fields]="field.fields"
        >
        </dyna-group>

        <ng-container *ngSwitchDefault>
          <ng-container *ngIf="customFieldsTemplate">
            <ng-container
              *ngTemplateOutlet="
                customFieldsTemplate;
                context: { field: field, control: getControl(control, field) }
              "
            ></ng-container>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</div>
<button class="dyna-button add-item" (click)="addItem()">Add new</button>

<dyna-hint [field]="field" [control]="controlsArray">
  {{ field.hint }}
</dyna-hint>
